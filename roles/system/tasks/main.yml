---
# tasks file for opendistro-elastic

# - name: configure elasticsearch hosts file
#   template:
#     src: templates/hosts.j2
#     dest: /etc/hosts
#     owner: root
#     group: root
#     mode: 0642
#   become: yes

#install common packages
- name: Install a list of packages
  apt:
    pkg:
      - zsh
      - nano
      - facter
      - awscli
      - jq
      - mlocate

- name: configure resolv.conf file
  template:
    src: templates/resolv.conf.j2
    dest: /etc/resolv.conf
    owner: root
    group: root
    mode: 0644
  become: yes
#######
- name: Ensure group "admin" exists
  group:
    name: admin
    state: present

###add jareking 
- name: Add jareking
  user:
    name: jareking
    shell: /bin/zsh
    groups: admin
    append: yes

- name: add jareking ssh pubkey
  authorized_key:
    user: jareking
    state: present
    key: '{{ item }}'
  with_file:
    - public_keys/jareking  

# NOTE: Fully quoted because of the ': ' on the line. See the Gotchas in the YAML docs.
- name: Validate the sudoers file before saving
  lineinfile:
    path: /etc/sudoers
    state: present
    regexp: '^%ADMIN ALL='
    line: '%ADMIN ALL=(ALL) NOPASSWD: ALL'
    validate: /usr/sbin/visudo -cf %s
Status    

########