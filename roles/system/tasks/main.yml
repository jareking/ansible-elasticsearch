---
# tasks file for opendistro-elastic

# - name: configure elasticsearch hosts file
#   template:
#     src: templates/hosts.j2
#     dest: /etc/hosts
#     owner: root
#     group: root
#     mode: 0642
#   become: yes

#install common packages
- name: Install a list of packages
  apt:
    pkg:
      - zsh
      - nano
      - facter
      - awscli
      #- jq

- name: configure resolv.conf file
  template:
    src: templates/resolv.conf.j2
    dest: /etc/resolv.conf
    owner: root
    group: root
    mode: 0644
  become: yes
# - name: Update the /etc/hosts file with node name
#   tags: etchostsupdate
#     become: yes
#     become_user: root
#     lineinfile:
#         path: "/etc/hosts"
#         regexp: ".*\t{{ hostvars[item]['ansible_hostname']}}\t{{ hostvars[item]['ansible_hostname']}}"
#         line: "{{ hostvars[item]['ansible_env'].SSH_CONNECTION.split(' ')[2] }}\t{{ hostvars[item]['ansible_hostname']}}\t{{ hostvars[item]['ansible_hostname']}}"
#         state: present
#         backup: yes
#       register: etchostsupdate
#       when: ansible_hostname != "{{ item }}" or ansible_hostname == "{{ item }}"
#       with_items: "{{groups['multi']}}"


- name: Add jareking
  user:
    name: jareking
    shell: /bin/zsh
    groups: admins
    append: yes
    #ssh_public_key: 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDXUDCTq7kPHxRLt9gTQNVIeTdD45+RkRTnNVMS1lyGIuoF0P+Gd7ig+AselNIbOWgQW4RVvIb/T8mitpOP5dlcCnfa3m6SRUsfrrQO+E3x0kReOuMlo0aj7bsjhx7/fc2DUCxBbF0oM5NI0JD1xaH1lJZCaY4ud0aLUh5gFl5rHSwr4tVDmK2LJmdC9X7QM5nXYMhFNG0w22SkImrGlq/WRUMw4UooN9CcnZGONldl1TUqyL5wHiFTxBZTQa0qkZJWe/VTkAeywrNlG5uvaq8fxY7X9uQY36+gg70ZUO1qf9+8olin+hYA4b/mYstxlr4a8v5288qLdmNHC5Giziuv jsking@ubuntu14.localdomain'